<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Music Player</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽµ</text></svg>">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>My Music Library</h1>
                <div class="search-container">
                    <input type="text" id="search-bar" placeholder="Search for a song or artist...">
                </div>
            </div>
        </header>
        <main>
            <div class="music-grid">
                {% for music in music_files %}
                <div class="music-card" data-song-id="{{ music.id }}">
                    <div class="artwork-container">
                        {% if music.artwork and music.artwork.data %}
                        <img src="data:{{ music.artwork.mime }};base64,{{ music.artwork.data }}" alt="Album Art for {{ music.album }}" loading="lazy">
                        {% else %}
                        <div class="no-art">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                        </div>
                        {% endif %}
                        <div class="card-overlay">
                            <button class="play-button" title="Play Now">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1"><path d="M8 5v14l11-7z"></path></svg>
                            </button>
                            <button class="add-queue-button" title="Add to Queue">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            </button>
                        </div>
                    </div>
                    <div class="info">
                        <div class="title" title="{{ music.title }}">{{ music.title }}</div>
                        <div class="artist" title="{{ music.artist }}">{{ music.artist }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </main>
    </div>

    <!-- Persistent Bottom Player -->
    <div class="player-bar">
        <div class="player-song-info">
            <div class="player-artwork">
                <div class="no-art-player">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                </div>
            </div>
            <div class="player-text">
                <div class="player-title">No Song Selected</div>
                <div class="player-artist"></div>
            </div>
        </div>
        <div class="player-controls">
            <div class="top-controls">
                <button id="shuffle-btn" class="control-btn" title="Shuffle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>
                </button>
                <button id="prev-btn" class="control-btn" title="Previous">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path></svg>
                </button>
                <button id="play-pause-btn" class="control-btn play-pause" title="Play">
                    <!-- Play and Pause SVGs will be toggled here -->
                </button>
                <button id="next-btn" class="control-btn" title="Next">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"></path></svg>
                </button>
                <button id="repeat-btn" class="control-btn" title="Repeat">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg>
                </button>
            </div>
            <div class="progress-controls">
                <span id="current-time">0:00</span>
                <input type="range" id="progress-bar" value="0" step="1">
                <span id="duration">0:00</span>
            </div>
        </div>
        <div class="player-extra-controls">
             <button id="queue-btn" class="control-btn" title="Queue">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
            </button>
        </div>
    </div>

    <!-- Queue Modal -->
    <div id="queue-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Play Queue</h2>
                <button id="close-queue-btn">&times;</button>
            </div>
            <ul id="queue-list">
                <!-- Queue items will be dynamically inserted here -->
            </ul>
        </div>
    </div>

    <audio id="audio-player"></audio>

    <!-- Pass music data to JavaScript in a data block -->
    <script id="song-data" type="application/json">
        {{ music_files|tojson|safe }}
    </script>
    <script src="{{ url_for('static', filename='player.js') }}"></script>
</body>
</html>
